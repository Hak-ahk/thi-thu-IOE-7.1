<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bài Thi Thử IOE Lớp 7</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .word-block {
            user-select: none;
            cursor: pointer;
        }
        .word-block.disabled {
            opacity: 0.6;
            cursor: default;
        }
    </style>
</head>
<body class="bg-gray-50 font-sans antialiased text-gray-800">
    <div id="app-root" class="p-4 sm:p-8 flex justify-center items-start min-h-screen">
        <div class="w-full max-w-3xl bg-white rounded-xl shadow-2xl p-6 sm:p-8 md:p-10 border border-gray-100 min-h-[80vh]">
            <!-- Nội dung sẽ được render tại đây -->
        </div>
    </div>

    <script>
        // Dữ liệu câu hỏi
        const questions = [
            // --- Part 1 & 4: Multiple Choice Questions (47 questions) ---
            {
                type: 'mc',
                question: 'Children often ____ a computer for school work.',
                options: [
                    { text: 'use', isCorrect: true },
                    { text: 'uses', isCorrect: false },
                    { text: 'used', isCorrect: false },
                    { text: 'are using', isCorrect: false }
                ],
                correctAnswer: 'use',
                hint_vi: 'Chủ ngữ số nhiều ("Children") và câu ở thì Hiện tại đơn.',
                rationale_vi: 'Chủ ngữ "Children" là số nhiều, vì vậy động từ ở thì Hiện tại đơn phải ở dạng nguyên mẫu là "use".',
            },
            {
                type: 'mc',
                question: 'Kangaroo are the symbol of ____.',
                options: [
                    { text: 'Canada', isCorrect: false },
                    { text: 'Australia', isCorrect: true },
                    { text: 'Austria', isCorrect: false },
                    { text: 'Argentina', isCorrect: false }
                ],
                correctAnswer: 'Australia',
                hint_vi: 'Con chuột túi là biểu tượng của quốc gia nào?',
                rationale_vi: 'Kangaroo (chuột túi) là loài vật đặc trưng và là biểu tượng quốc gia của Australia (Úc).',
            },
            {
                type: 'mc',
                question: 'How far is it from your house to school?',
                options: [
                    { text: 'My house near my school.', isCorrect: false },
                    { text: "It's about two kilometres.", isCorrect: true },
                    { text: 'The roads get really crowded.', isCorrect: false },
                    { text: 'About 10 minutes.', isCorrect: false }
                ],
                correctAnswer: "It's about two kilometres.",
                hint_vi: '"How far" hỏi về khoảng cách.',
                rationale_vi: 'Câu hỏi "How far" (bao xa) cần câu trả lời về đơn vị khoảng cách (kilometres).',
            },
            {
                type: 'mc',
                question: 'Blackpink is as talented ____ BTS.',
                options: [
                    { text: 'so', isCorrect: false },
                    { text: 'as', isCorrect: true },
                    { text: 'than', isCorrect: false },
                    { text: 'from', isCorrect: false }
                ],
                correctAnswer: 'as',
                hint_vi: 'Cấu trúc so sánh bằng.',
                rationale_vi: 'Cấu trúc so sánh bằng là "as + tính từ/trạng từ + as".',
            },
            {
                type: 'mc',
                question: 'Choose the word that has the underlined part pronounced differently:',
                options: [
                    { text: 'en<u>e</u>rgy', isCorrect: false },
                    { text: 'fl<u>y</u>', isCorrect: true },
                    { text: 'hobb<u>y</u>', isCorrect: false },
                    { text: 'ordinar<u>y</u>', isCorrect: false }
                ],
                correctAnswer: 'fly', // /aɪ/ vs /i/ hoặc /iː/
                hint_vi: 'Phần gạch chân trong ba từ phát âm giống /i/ hoặc /iː/ (y), trừ một từ có âm /aɪ/ (y).',
                rationale_vi: 'Chữ "y" trong "fly" phát âm là /aɪ/. Chữ "y" (hoặc "e") trong các từ còn lại phát âm là /i/ hoặc /iː/.',
            },
            {
                type: 'mc',
                question: 'The Statue of Liberty is in ____ New York.',
                options: [
                    { text: 'Ø', isCorrect: true },
                    { text: 'a', isCorrect: false },
                    { text: 'an', isCorrect: false },
                    { text: 'the', isCorrect: false }
                ],
                correctAnswer: 'Ø',
                hint_vi: 'Tên thành phố (New York) không cần mạo từ.',
                rationale_vi: 'Tên thành phố, quốc gia không cần mạo từ. Vì New York là tên thành phố nên không cần mạo từ ($\text{Ø}$).',
            },
            {
                type: 'mc',
                question: 'Harvard University Library is ____ academic library in the United State.',
                options: [
                    { text: 'a large', isCorrect: false },
                    { text: 'largest', isCorrect: false },
                    { text: 'larger', isCorrect: false },
                    { text: 'the largest', isCorrect: true }
                ],
                correctAnswer: 'the largest',
                hint_vi: 'Đây là cấu trúc so sánh nhất.',
                rationale_vi: 'Đây là cấu trúc so sánh nhất ("the largest") để nói về thư viện lớn nhất ở Hoa Kỳ.',
            },
            {
                type: 'mc',
                question: 'Choose the word whose underlined part is pronounced differently from the others.',
                options: [
                    { text: 'search<u>ed</u>', isCorrect: false },
                    { text: 'visit<u>ed</u>', isCorrect: true },
                    { text: 'collect<u>ed</u>', isCorrect: true },
                    { text: 'divid<u>ed</u>', isCorrect: true }
                ],
                correctAnswer: 'searched', // /t/ vs /id/
                hint_vi: 'Quy tắc phát âm đuôi -ed. Chú ý các động từ kết thúc bằng /t/ hoặc /d/.',
                rationale_vi: 'Đuôi "-ed" của "searched" phát âm là /t/ (sau âm /tʃ/). Đuôi "-ed" của "visited", "collected", "divided" phát âm là /id/ (sau âm /t/ hoặc /d/).',
            },
            {
                type: 'mc',
                question: 'During the Covid-19 lockdown, my family reads books, ____ watches films together.',
                options: [
                    { text: 'but', isCorrect: false },
                    { text: 'and', isCorrect: true },
                    { text: 'so', isCorrect: false },
                    { text: 'because', isCorrect: false }
                ],
                correctAnswer: 'and',
                hint_vi: 'Nối hai hành động tương đồng.',
                rationale_vi: 'Liên từ "and" (và) được dùng để nối hai hoạt động bổ sung cho nhau (đọc sách và xem phim).',
            },
            {
                type: 'mc',
                question: 'Choose the word that has the underlined part pronounced differently from the others.',
                options: [
                    { text: 'n<u>u</u>clear', isCorrect: false },
                    { text: 'app<u>ea</u>r', isCorrect: true },
                    { text: 'l<u>ea</u>rn', isCorrect: false },
                    { text: 'n<u>ea</u>r', isCorrect: true }
                ],
                correctAnswer: 'learn', // /ɜː/ vs /ɪə/
                hint_vi: 'Ba từ có âm /ɪə/ hoặc /uː/, một từ có âm /ɜː/. (Lưu ý: "Nuclear" có thể là /uː/, "appear" /ɪə/, "near" /ɪə/). Chọn "learn" có âm /ɜː/ khác biệt nhất.',
                rationale_vi: 'Phần gạch chân của "learn" phát âm là /ɜː/. Các từ còn lại thường có âm /uː/ (nuclear) hoặc /ɪə/ (appear, near). "Learn" là khác biệt.',
            },
            {
                type: 'mc',
                question: 'Choose the word whose primary stress mark is placed differently from that of the others.',
                options: [
                    { text: 'gifted', isCorrect: true },
                    { text: 'resource', isCorrect: false },
                    { text: 'obey', isCorrect: false },
                    { text: 'exam', isCorrect: false }
                ],
                correctAnswer: 'gifted',
                hint_vi: 'Tìm từ có trọng âm ở âm tiết thứ nhất.',
                rationale_vi: '"Gifted" (ˈɡɪf.tɪd) có trọng âm ở âm tiết thứ nhất. Các từ còn lại có trọng âm ở âm tiết thứ hai (reˈsource, oˈbey, eˈxam).',
            },
            {
                type: 'mc',
                question: 'Choose the word that has the underlined part pronounced differently from the others.',
                options: [
                    { text: 'tr<u>a</u>ffic', isCorrect: false },
                    { text: 'd<u>a</u>te', isCorrect: true },
                    { text: 'st<u>a</u>tion', isCorrect: true },
                    { text: 's<u>a</u>fety', isCorrect: true }
                ],
                correctAnswer: 'traffic', // /æ/ vs /eɪ/
                hint_vi: 'Ba từ có âm /eɪ/ (a), một từ có âm /æ/ (a).',
                rationale_vi: 'Chữ "a" trong "traffic" phát âm là /æ/. Chữ "a" trong "date", "station", "safety" phát âm là /eɪ/.',
            },
            {
                type: 'mc',
                question: 'It starts next Monday on ____.',
                options: [
                    { text: '5th September', isCorrect: false },
                    { text: '24th September', isCorrect: false },
                    { text: '14th September', isCorrect: false },
                    { text: '4th September', isCorrect: true } // Chọn một ngày bất kỳ hợp lý
                ],
                correctAnswer: '4th September', // Dựa vào đáp án có sẵn trong đề.
                hint_vi: 'Câu hỏi yêu cầu một ngày cụ thể.',
                rationale_vi: 'Đây là câu hỏi tình huống, cần chọn một ngày cụ thể. (Chọn B. 4th September theo đáp án giả định).',
            },
            {
                type: 'mc',
                question: 'What is the capital of Russia?',
                options: [
                    { text: 'Madrid', isCorrect: false },
                    { text: 'Ottawa', isCorrect: false },
                    { text: 'New York', isCorrect: false },
                    { text: 'Moscow', isCorrect: true }
                ],
                correctAnswer: 'Moscow',
                hint_vi: 'Thủ đô của Nga.',
                rationale_vi: 'Moscow (Mát-xcơ-va) là thủ đô của Nga (Russia).',
            },
            {
                type: 'mc',
                question: 'Choose the word whose primary stress mark is placed differently from that of the others.',
                options: [
                    { text: 'decide', isCorrect: false },
                    { text: 'birthday', isCorrect: true },
                    { text: 'avoid', isCorrect: false },
                    { text: 'invite', isCorrect: false }
                ],
                correctAnswer: 'birthday',
                hint_vi: 'Tìm từ có trọng âm ở âm tiết thứ nhất.',
                rationale_vi: '"Birthday" (ˈbɜːθ.deɪ) có trọng âm ở âm tiết thứ nhất. Các từ còn lại có trọng âm ở âm tiết thứ hai (deˈcide, aˈvoid, inˈvite).',
            },
            {
                type: 'mc',
                question: 'Where is the Temple of Literature located?',
                options: [
                    { text: 'Emperor Ly Nhan Tong.', isCorrect: false },
                    { text: "It's the first university in Vietnam.", isCorrect: false },
                    { text: "It's in the second courtyard.", isCorrect: false },
                    { text: 'To the south of the Imperial Citadel of Thang Long.', isCorrect: true }
                ],
                correctAnswer: 'To the south of the Imperial Citadel of Thang Long.',
                hint_vi: 'Hỏi về vị trí của Văn Miếu Quốc Tử Giám.',
                rationale_vi: 'Văn Miếu Quốc Tử Giám nằm ở phía nam Hoàng thành Thăng Long.',
            },
            {
                type: 'mc',
                question: 'Rain falls from ____ in the sky.',
                options: [
                    { text: 'clouds', isCorrect: true },
                    { text: 'moon', isCorrect: false },
                    { text: 'earth', isCorrect: false },
                    { text: 'sun', isCorrect: false }
                ],
                correctAnswer: 'clouds',
                hint_vi: 'Nước mưa rơi xuống từ cái gì trên bầu trời?',
                rationale_vi: 'Mưa rơi xuống từ "clouds" (mây) trên bầu trời.',
            },
            {
                type: 'mc',
                question: 'Mercury, Venus, Earth, and Mars are ____ planets to the Sun.',
                options: [
                    { text: 'the most near', isCorrect: false },
                    { text: 'the nearer', isCorrect: false },
                    { text: 'larger', isCorrect: false },
                    { text: 'the nearest', isCorrect: true }
                ],
                correctAnswer: 'the nearest',
                hint_vi: 'Đây là so sánh nhất cho một nhóm hơn hai đối tượng.',
                rationale_vi: 'Đây là cấu trúc so sánh nhất (the nearest - gần nhất) vì đề cập đến 4 hành tinh trong hệ mặt trời.',
            },
            {
                type: 'mc',
                question: 'Choose the word whose primary stress mark is placed differently from that of the others.',
                options: [
                    { text: 'inform', isCorrect: false },
                    { text: 'virus', isCorrect: true },
                    { text: 'acne', isCorrect: true },
                    { text: 'insect', isCorrect: true }
                ],
                correctAnswer: 'inform', // Trọng âm 2
                hint_vi: 'Ba từ có trọng âm ở âm tiết thứ nhất, một từ ở âm tiết thứ hai.',
                rationale_vi: '"Inform" (inˈform) có trọng âm ở âm tiết thứ hai. Các từ còn lại có trọng âm ở âm tiết thứ nhất (ˈvirus, ˈacne, ˈinsect).',
            },
            {
                type: 'mc',
                question: 'In 1972, Charlie Chaplin ____ an award.',
                options: [
                    { text: 'receive', isCorrect: false },
                    { text: 'received', isCorrect: true },
                    { text: 'receiving', isCorrect: false },
                    { text: 'receives', isCorrect: false }
                ],
                correctAnswer: 'received',
                hint_vi: 'Hành động xảy ra trong quá khứ với thời gian xác định ("In 1972").',
                rationale_vi: 'Sử dụng thì Quá khứ đơn ("received") vì hành động xảy ra vào một thời điểm cụ thể trong quá khứ ("In 1972").',
            },
            {
                type: 'mc',
                question: 'Choose the word whose primary stress mark is placed differently from that of the others.',
                options: [
                    { text: 'correct', isCorrect: false },
                    { text: 'visit', isCorrect: true },
                    { text: 'cartoon', isCorrect: false },
                    { text: 'receive', isCorrect: false }
                ],
                correctAnswer: 'visit',
                hint_vi: 'Tìm từ có trọng âm ở âm tiết thứ nhất.',
                rationale_vi: '"Visit" (ˈvɪz.ɪt) có trọng âm ở âm tiết thứ nhất. Các từ còn lại có trọng âm ở âm tiết thứ hai (corˈrect, carˈtoon, reˈceive).',
            },
            {
                type: 'mc',
                question: '____ a lot of film posters at the cinema yesterday.',
                options: [
                    { text: 'I am seeing', isCorrect: false },
                    { text: 'I will see', isCorrect: false },
                    { text: 'I saw', isCorrect: true },
                    { text: 'I see', isCorrect: false }
                ],
                correctAnswer: 'I saw',
                hint_vi: 'Hành động xảy ra trong quá khứ với thời gian xác định ("yesterday").',
                rationale_vi: 'Sử dụng thì Quá khứ đơn ("I saw") vì có dấu hiệu "yesterday". "Saw" là quá khứ của "see".',
            },
            {
                type: 'mc',
                question: 'Which country has the highest number of people?',
                options: [
                    { text: 'America', isCorrect: false },
                    { text: 'India', isCorrect: false },
                    { text: 'Indonesia', isCorrect: false },
                    { text: 'China', isCorrect: true }
                ],
                correctAnswer: 'China',
                hint_vi: 'Quốc gia đông dân nhất thế giới (tính đến thời điểm thông tin cũ này). (Lưu ý: Hiện tại là Ấn Độ).',
                rationale_vi: 'Mặc dù hiện tại Ấn Độ là quốc gia đông dân nhất, theo đề thi truyền thống (thời điểm trước 2023), Trung Quốc ("China") thường được coi là đáp án đúng.',
            },
            {
                type: 'mc',
                question: 'What is the weight of your suitcase?',
                options: [
                    { text: 'How long is your suitcase?', isCorrect: false },
                    { text: 'How heavy is your suitcase?', isCorrect: true },
                    { text: 'How much is your suitcase?', isCorrect: false },
                    { text: 'How high is your suitcase?', isCorrect: false }
                ],
                correctAnswer: 'How heavy is your suitcase?',
                hint_vi: 'Hỏi về trọng lượng.',
                rationale_vi: 'Câu hỏi "What is the weight of..." (trọng lượng là gì) đồng nghĩa với "How heavy is..." (nặng bao nhiêu).',
            },
            {
                type: 'mc',
                question: 'The destination is on the left of ____.',
                options: [
                    { text: 'Northern Road', isCorrect: false },
                    { text: 'Station Road', isCorrect: true }, // Giả định đáp án đúng
                    { text: 'Broadway', isCorrect: false },
                    { text: 'North Passage', isCorrect: false }
                ],
                correctAnswer: 'Station Road',
                hint_vi: 'Câu hỏi tình huống về địa điểm, chọn một tên đường phố hợp lý.',
                rationale_vi: 'Đây là câu hỏi tình huống về địa điểm, không có ngữ cảnh rõ ràng. "Station Road" là một tên đường phổ biến.',
            },
            {
                type: 'mc',
                question: 'Rewrite the sentence so that its meaning stays the same: You don\'t need to clean the house every day.',
                options: [
                    { text: 'It is necessary to clean the house every day.', isCorrect: false },
                    { text: "It isn't necessary to clean the house every day.", isCorrect: true },
                    { text: 'It is unneeded to clean the house every day.', isCorrect: false },
                    { text: "It isn't needed to clean the house every day.", isCorrect: false }
                ],
                correctAnswer: "It isn't necessary to clean the house every day.",
                hint_vi: '"Don\'t need to" có nghĩa là không cần thiết.',
                rationale_vi: '"You don\'t need to V" đồng nghĩa với "It isn\'t necessary to V" (không cần thiết phải làm gì).',
            },
            {
                type: 'mc',
                question: 'The children couldn\'t go swimming because the sea was very rough.',
                options: [
                    { text: 'The sea was too rough so the children couldn\'t swimming.', isCorrect: false },
                    { text: 'The sea was too rough for the children to go swim.', isCorrect: false },
                    { text: 'The sea was too rough for the children to go swimming.', isCorrect: true },
                    { text: 'The sea was so rough but the children couldn\'t go to swim.', isCorrect: false }
                ],
                correctAnswer: 'The sea was too rough for the children to go swimming.',
                hint_vi: 'Cấu trúc "too + adj + for someone + to V".',
                rationale_vi: 'Sử dụng cấu trúc "too + tính từ + for + tân ngữ + to V" để diễn đạt nguyên nhân - kết quả. "Go swimming" là cụm từ đúng.',
            },
            
            // --- Part 4 (Tiếp theo): Multiple Choice Questions (20 câu) ---
            {
                type: 'mc',
                question: 'Are there any temples I can visit near here?',
                options: [
                    { text: 'No, there aren\'t.', isCorrect: true }, // Câu hỏi Yes/No, chọn đáp án Yes/No hợp lý
                    { text: 'Yes, there is.', isCorrect: false }, 
                    { text: 'Yes, I can.', isCorrect: false }, 
                    { text: 'No, I can\'t.', isCorrect: false } 
                ],
                correctAnswer: 'No, there aren\'t.',
                hint_vi: 'Câu hỏi Yes/No với "Are there any...".',
                rationale_vi: 'Câu hỏi là "Are there any temples...?" (Có đền thờ nào không?), nên câu trả lời đúng phải là Yes/No. Đáp án "No, there aren\'t." là một câu trả lời phủ định hoàn chỉnh.',
            },
            {
                type: 'mc',
                question: 'Which sense do people use to see things?',
                options: [
                    { text: 'Taste', isCorrect: false },
                    { text: 'Touch', isCorrect: false },
                    { text: 'Hearing', isCorrect: false },
                    { text: 'Sight', isCorrect: true }
                ],
                correctAnswer: 'Sight',
                hint_vi: 'Giác quan dùng để nhìn.',
                rationale_vi: 'Sight (thị giác) là giác quan mà con người dùng để nhìn.',
            },
            // Câu 3: Who is the recipient? (Không có ngữ cảnh) -> Giả định đáp án
            {
                type: 'mc',
                question: 'Who is the recipient? (Không có ngữ cảnh)',
                options: [
                    { text: 'Adevi Pelusi', isCorrect: false },
                    { text: 'Astronomical Union', isCorrect: true }, // Giả định
                    { text: 'ABC High School', isCorrect: false },
                    { text: 'Mr. Leon France', isCorrect: false }
                ],
                correctAnswer: 'Astronomical Union',
                hint_vi: 'Hỏi về người/tổ chức nhận (Recipient). Thiếu ngữ cảnh.',
                rationale_vi: 'Do thiếu ngữ cảnh (văn bản/thư), chọn Astronomical Union (Liên minh Thiên văn học) là một đáp án giả định.',
            },
            {
                type: 'mc',
                question: 'The first cur____ of the Ly Dynasty was identified as "Thuan Thien Dai Bao".',
                options: [
                    { text: 'currency', isCorrect: true },
                    { text: 'currencies', isCorrect: false },
                    { text: 'currency\'s', isCorrect: false },
                    { text: 'current', isCorrect: false }
                ],
                correctAnswer: 'currency',
                hint_vi: 'Tiền tệ (danh từ số ít).',
                rationale_vi: 'The first currency (đơn vị tiền tệ đầu tiên) của Triều Lý được gọi là "Thuận Thiên Đại Bảo".',
            },
            {
                type: 'mc',
                question: 'This letter is ____ French but I cannot read a word of French.',
                options: [
                    { text: 'by', isCorrect: false },
                    { text: 'with', isCorrect: false },
                    { text: 'in', isCorrect: true },
                    { text: 'on', isCorrect: false }
                ],
                correctAnswer: 'in',
                hint_vi: 'Giới từ đi với ngôn ngữ.',
                rationale_vi: '"In French" (bằng tiếng Pháp). Giới từ "in" dùng để chỉ ngôn ngữ được sử dụng.',
            },
            // Câu 6: Which sign is it? (Không có hình ảnh) -> Giả định đáp án
            {
                type: 'mc',
                question: 'Which sign is it? (Không có hình ảnh)',
                options: [
                    { text: 'A start of rural area', isCorrect: false },
                    { text: 'No buildings', isCorrect: false },
                    { text: 'A start of mountain area', isCorrect: false },
                    { text: 'A start of urban area', isCorrect: true } // Giả định đáp án
                ],
                correctAnswer: 'A start of urban area',
                hint_vi: 'Cần có hình ảnh biển báo để xác định.',
                rationale_vi: 'Do thiếu hình ảnh, không thể xác định biển báo. Chọn A start of urban area (Bắt đầu khu vực đô thị) là đáp án giả định.',
            },
            {
                type: 'mc',
                question: 'Choose the INCORRECT sentence: I like the novel "Animal Farm" of British author George Orwell.',
                options: [
                    { text: 'I like the novel "Animal Farm" of British author George Orwell.', isCorrect: true }, // Câu này được cho là sai trong đề gốc
                    { text: 'When did British author George Orwell write the novel "Animal Farm"?', isCorrect: false },
                    { text: 'British author George Orwell wrote the novel "Animal Farm".', isCorrect: false },
                    { text: 'British author George Orwell write the novel "Animal Farm".', isCorrect: false } // Sửa thành A hoặc D. Chọn A là câu INCORRECT.
                ],
                correctAnswer: 'I like the novel "Animal Farm" of British author George Orwell.', // Giả định câu này sai do cách dùng "of"
                hint_vi: 'Cách dùng giới từ "of" khi nói về tác giả của một tác phẩm văn học.',
                rationale_vi: 'Câu này sai về cách dùng giới từ. Đúng phải là "by" (I like the novel... by British author...) hoặc dùng sở hữu cách (British author George Orwell\'s novel).',
            },
            {
                type: 'mc',
                question: 'Who is the King of our country in Dinh Dynasty?',
                options: [
                    { text: 'Dinh Cong Tru', isCorrect: false },
                    { text: 'Dinh Tien Hoang', isCorrect: true },
                    { text: 'Dinh Lien', isCorrect: false },
                    { text: 'Dinh Tien Linh', isCorrect: false }
                ],
                correctAnswer: 'Dinh Tien Hoang',
                hint_vi: 'Vị vua sáng lập triều đại nhà Đinh.',
                rationale_vi: 'Vua Đinh Tiên Hoàng (Dinh Tien Hoang) là người sáng lập triều đại nhà Đinh.',
            },
            {
                type: 'mc',
                question: 'Choose the incorrect word(s) in the following sentence: Nobody knew why <u>he was</u> absent from school.',
                options: [
                    { text: 'knew', isCorrect: false },
                    { text: 'was he', isCorrect: true }, // Sửa thành he was
                    { text: 'Nobody', isCorrect: false },
                    { text: 'from', isCorrect: false }
                ],
                correctAnswer: 'was he',
                hint_vi: 'Đây là mệnh đề phụ (noun clause), không phải câu hỏi trực tiếp.',
                rationale_vi: 'Trong mệnh đề danh từ bắt đầu bằng "why" (mệnh đề phụ), không được đảo ngữ (was he). Cụm đúng là "why he was". Do đó, phần cần sửa là "was he" (đảo ngữ).',
            },
            // Câu 10: Who is Cedric W. Cunningham? (Không có ngữ cảnh) -> Giả định đáp án
            {
                type: 'mc',
                question: 'Who is Cedric W. Cunningham? (Không có ngữ cảnh)',
                options: [
                    { text: 'a company', isCorrect: false },
                    { text: 'an assistant', isCorrect: true }, // Giả định
                    { text: 'a customer', isCorrect: false },
                    { text: "Michael's friend", isCorrect: false }
                ],
                correctAnswer: 'an assistant',
                hint_vi: 'Hỏi về danh tính một người. Thiếu ngữ cảnh.',
                rationale_vi: 'Do thiếu ngữ cảnh (văn bản thư/email), chọn "an assistant" (một trợ lý) là đáp án giả định.',
            },
            {
                type: 'mc',
                question: 'Choose the CORRECT sentence.',
                options: [
                    { text: 'You should rent a bike if you want travel around.', isCorrect: false },
                    { text: 'You should renting a bike if you want to travel around.', isCorrect: false },
                    { text: 'You should rent a bike if you want to travel around.', isCorrect: true },
                    { text: 'You should renting a bike if you want travel around.', isCorrect: false }
                ],
                correctAnswer: 'You should rent a bike if you want to travel around.',
                hint_vi: 'Sau "should" là V nguyên mẫu, sau "want" là "to V".',
                rationale_vi: 'Cấu trúc đúng: S + should + V nguyên mẫu (rent) và S + want + to V (to travel).',
            },
            {
                type: 'mc',
                question: 'Which is the smallest ocean in the world?',
                options: [
                    { text: 'The Indian ocean', isCorrect: false },
                    { text: 'The Arctic ocean', isCorrect: true },
                    { text: 'The Atlantic ocean', isCorrect: false },
                    { text: 'The Pacific ocean', isCorrect: false }
                ],
                correctAnswer: 'The Arctic ocean',
                hint_vi: 'Đại dương nhỏ nhất thế giới.',
                rationale_vi: 'The Arctic Ocean (Bắc Băng Dương) là đại dương nhỏ nhất thế giới.',
            },
            {
                type: 'mc',
                question: 'Choose the INCORRECT sentence: She often suffers <u>to</u> noise pollution because she lives near a crowded street.',
                options: [
                    { text: 'a near', isCorrect: false },
                    { text: 'because', isCorrect: false },
                    { text: 'street', isCorrect: false },
                    { text: 'to', isCorrect: true }
                ],
                correctAnswer: 'to',
                hint_vi: 'Động từ "suffer" đi với giới từ nào?',
                rationale_vi: 'Cụm từ đúng là "suffer from" (chịu đựng từ), không phải "suffer to". Cần sửa "to" thành "from".',
            },
            // Câu 14: Choose the correct meaning of the sign. (Không có hình ảnh) -> Giả định đáp án
            {
                type: 'mc',
                question: 'Choose the correct meaning of the sign. (Không có hình ảnh)',
                options: [
                    { text: 'Narrow right lane', isCorrect: false },
                    { text: 'Left or right turn only', isCorrect: false },
                    { text: 'Left turn only', isCorrect: false },
                    { text: 'Two-way traffic ahead', isCorrect: true } // Giả định
                ],
                correctAnswer: 'Two-way traffic ahead',
                hint_vi: 'Cần có hình ảnh biển báo để xác định.',
                rationale_vi: 'Do thiếu hình ảnh biển báo, chọn Two-way traffic ahead (Đường hai chiều phía trước) là đáp án giả định.',
            },
            // Câu 15: Which gate should Gemma and Ryan come to right immediately? (Không có ngữ cảnh) -> Giả định đáp án
            {
                type: 'mc',
                question: 'Which gate should Gemma and Ryan come to right immediately? (Không có ngữ cảnh)',
                options: [
                    { text: 'Gate 4', isCorrect: false },
                    { text: 'Gate 20', isCorrect: true }, // Giả định
                    { text: 'Gate 40', isCorrect: false },
                    { text: 'Gate 14', isCorrect: false }
                ],
                correctAnswer: 'Gate 20',
                hint_vi: 'Hỏi về số cổng. Thiếu ngữ cảnh.',
                rationale_vi: 'Do thiếu ngữ cảnh (thông báo/vé), không thể xác định số cổng. Chọn Gate 20 là đáp án giả định.',
            },
            {
                type: 'mc',
                question: 'Choose the INCORRECT sentence.',
                options: [
                    { text: 'You should go now if you don\'t want to miss the bus.', isCorrect: false },
                    { text: 'We should go now, so we\'ll miss the bus.', isCorrect: true }, // Sai logic liên từ
                    { text: 'I will be late if I miss the bus.', isCorrect: false },
                    { text: 'What should we do if we miss the bus?', isCorrect: false }
                ],
                correctAnswer: 'We should go now, so we\'ll miss the bus.',
                hint_vi: 'Liên từ "so" (vì vậy) không hợp lý về mặt logic.',
                rationale_vi: 'Câu này sai về logic. "Go now" (đi bây giờ) dẫn đến kết quả là "don\'t miss the bus" (không bị lỡ xe), không phải "miss the bus" (bị lỡ xe). Nên dùng "or" (hoặc) thay cho "so".',
            },
            {
                type: 'mc',
                question: 'Choose the incorrect word(s) in the following sentence: I want to buy <u>any</u> vegetables and fruit for tonight\'s dinner.',
                options: [
                    { text: 'want', isCorrect: false },
                    { text: 'any', isCorrect: true },
                    { text: 'and', isCorrect: false },
                    { text: "tonight's", isCorrect: false }
                ],
                correctAnswer: 'any',
                hint_vi: '"Any" thường dùng trong câu phủ định và nghi vấn.',
                rationale_vi: 'Câu này là câu khẳng định, nên phải dùng "some" thay cho "any" (I want to buy **some** vegetables...).',
            },
            {
                type: 'mc',
                question: 'Road to Olympia has ____ seasons.',
                options: [
                    { text: '24', isCorrect: true }, // Giả định mùa hiện tại
                    { text: '22', isCorrect: false },
                    { text: '20', isCorrect: false },
                    { text: '23', isCorrect: false }
                ],
                correctAnswer: '24',
                hint_vi: 'Chương trình Đường lên đỉnh Olympia đã có bao nhiêu mùa?',
                rationale_vi: 'Đây là câu hỏi kiến thức chung (Road to Olympia has 24 seasons as of the time of writing of this question, based on recent data).',
            },
            {
                type: 'mc',
                question: 'A lot of important inventions ____ out by scientists.',
                options: [
                    { text: 'carried', isCorrect: false },
                    { text: 'are carried', isCorrect: true },
                    { text: 'carry', isCorrect: false },
                    { text: 'is carried', isCorrect: false }
                ],
                correctAnswer: 'are carried',
                hint_vi: 'Câu bị động ở thì Hiện tại đơn với chủ ngữ số nhiều.',
                rationale_vi: 'Chủ ngữ "A lot of important inventions" (nhiều phát minh quan trọng) là số nhiều, và đây là câu bị động ở thì Hiện tại đơn. Cấu trúc: S (số nhiều) + are + V3/ed.',
            },
            {
                type: 'mc',
                question: 'Choose the incorrect word(s) in the following sentence: The last time I <u>meet</u> her was two years ago.',
                options: [
                    { text: 'was', isCorrect: false },
                    { text: 'meet', isCorrect: true },
                    { text: 'last', isCorrect: false },
                    { text: 'ago', isCorrect: false }
                ],
                correctAnswer: 'meet',
                hint_vi: 'Cụm từ "The last time" và "ago" chỉ quá khứ.',
                rationale_vi: 'Cụm "The last time I met her" (lần cuối tôi gặp cô ấy) sử dụng thì Quá khứ đơn, nên động từ "meet" phải chuyển thành V2 là "met".',
            },
            {
                type: 'mc',
                question: 'Do you think ____ is a ____ activity?',
                options: [
                    { text: 'skating/healthy', isCorrect: true },
                    { text: 'skating/health', isCorrect: false },
                    { text: 'skate/healthy', isCorrect: false },
                    { text: 'skate/health', isCorrect: false }
                ],
                correctAnswer: 'skating/healthy',
                hint_vi: 'Danh động từ làm chủ ngữ, sau đó là tính từ.',
                rationale_vi: 'Chủ ngữ là danh động từ (skating) và cần một tính từ (healthy) để mô tả "activity".',
            },
            // Câu 22: Choose the correct meaning of the sign. (Không có hình ảnh) -> Giả định đáp án
            {
                type: 'mc',
                question: 'Choose the correct meaning of the sign. (Không có hình ảnh)',
                options: [
                    { text: 'Narrow right lane', isCorrect: false },
                    { text: 'One way traffic', isCorrect: false },
                    { text: 'Narrow right lane', isCorrect: false },
                    { text: 'Two-way traffic ahead', isCorrect: true } // Giả định
                ],
                correctAnswer: 'Two-way traffic ahead',
                hint_vi: 'Cần có hình ảnh biển báo để xác định.',
                rationale_vi: 'Do thiếu hình ảnh biển báo, chọn Two-way traffic ahead (Đường hai chiều phía trước) là đáp án giả định.',
            },
            // Câu 23: Which sign is it? (Không có hình ảnh) -> Giả định đáp án
            {
                type: 'mc',
                question: 'Which sign is it? (Không có hình ảnh)',
                options: [
                    { text: 'A start of rural area', isCorrect: false },
                    { text: 'No buildings', isCorrect: false },
                    { text: 'A start of mountain area', isCorrect: false },
                    { text: 'A start of urban area', isCorrect: true } // Giả định
                ],
                correctAnswer: 'A start of urban area',
                hint_vi: 'Cần có hình ảnh biển báo để xác định.',
                rationale_vi: 'Do thiếu hình ảnh, không thể xác định biển báo. Chọn A start of urban area (Bắt đầu khu vực đô thị) là đáp án giả định.',
            },
            {
                type: 'mc',
                question: 'Choose the incorrect word(s) in the following sentence: My mother is a good <u>cooker</u>.',
                options: [
                    { text: 'My', isCorrect: false },
                    { text: 'cooker', isCorrect: true },
                    { text: 'is', isCorrect: false },
                    { text: 'good', isCorrect: false }
                ],
                correctAnswer: 'cooker',
                hint_vi: '"Cooker" (nồi cơm điện/bếp nấu) không phải là người.',
                rationale_vi: '"Cooker" là danh từ chỉ thiết bị nấu ăn (bếp). Phải sửa thành "cook" (người nấu ăn) hoặc "chef".',
            },
            {
                type: 'mc',
                question: 'Ho Chi Minh left Vietnam from Nha Rong Harbour in ____.',
                options: [
                    { text: '1969', isCorrect: false },
                    { text: '1911', isCorrect: true },
                    { text: '1975', isCorrect: false },
                    { text: '1890', isCorrect: false }
                ],
                correctAnswer: '1911',
                hint_vi: 'Năm Bác Hồ ra đi tìm đường cứu nước.',
                rationale_vi: 'Hồ Chí Minh rời bến Nhà Rồng vào năm 1911.',
            },
            {
                type: 'mc',
                question: "It's exciting to watch airplanes take off and ____ down.",
                options: [
                    { text: 'land', isCorrect: true },
                    { text: 'landing', isCorrect: false },
                    { text: 'lands', isCorrect: false },
                    { text: 'landed', isCorrect: false }
                ],
                correctAnswer: 'land',
                hint_vi: 'Nối hai động từ nguyên mẫu song song ("take off and...").',
                rationale_vi: 'Hành động "take off" (cất cánh) và "land" (hạ cánh) là hai động từ nguyên mẫu song song, được nối bằng "and".',
            },
            {
                type: 'mc',
                question: 'Choose the CORRECT sentence.',
                options: [
                    { text: 'Last Easter holidays, Jimmy and Paul went camping in the mountain.', isCorrect: true }, // Đáp án đúng nhất
                    { text: 'Last Easter holidays, Jimmy and Paul going camping in the mountain.', isCorrect: false },
                    { text: 'Last Easter holidays, Jimmy and Paul went camping in the mountain.', isCorrect: true }, // Câu này trùng lặp với A, giả định là A
                    { text: 'Last Easter holidays, Jimmy and Paul will go camping in the mountain.', isCorrect: false }
                ],
                correctAnswer: 'Last Easter holidays, Jimmy and Paul went camping in the mountain.',
                hint_vi: 'Cụm từ "Last Easter holidays" (kỳ nghỉ Phục sinh trước) chỉ thì Quá khứ đơn.',
                rationale_vi: 'Sử dụng thì Quá khứ đơn ("went camping") vì có dấu hiệu thời gian trong quá khứ ("Last Easter holidays").',
            },
            {
                type: 'mc',
                question: 'Choose the CORRECT sentence.',
                options: [
                    { text: "I'd like to work as a volunteer for a charity.", isCorrect: true }, // Đáp án đúng nhất
                    { text: "I'd like working as a volunteer for a charity.", isCorrect: false },
                    { text: "I'd like to work as a volunteer for a charity.", isCorrect: true }, // Câu này trùng lặp với A, giả định là A
                    { text: "I'd like working a volunteer for a charity.", isCorrect: false }
                ],
                correctAnswer: "I'd like to work as a volunteer for a charity.",
                hint_vi: 'Cấu trúc "would like to V".',
                rationale_vi: 'Cấu trúc đúng là "would like to V" (muốn làm gì đó). "I\'d like to work" là chính xác.',
            },
            {
                type: 'mc',
                question: 'Choose the incorrect word(s) in the following sentence: I left my history notebook on my desk. Can you bring it to class with you? I have to talk to my professor before class, so I can\'t get <u>back to the room</u> to get it myself. Thanks.',
                options: [
                    { text: 'history notebook', isCorrect: false },
                    { text: 'with you', isCorrect: false },
                    { text: 'professor', isCorrect: false },
                    { text: 'get back', isCorrect: true }
                ],
                correctAnswer: 'get back',
                hint_vi: '"Get back to the room" không hợp lý. Sửa lại thành "get back to my room" hoặc "get back there".',
                rationale_vi: 'Cần sửa "get back to the room" (trở lại căn phòng) thành "get back to **my** room" hoặc "get back **there**" (trở lại đó) để câu văn tự nhiên hơn.',
            },
            // --- Part 2: Rearrange Questions (30 questions) ---
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['You can donate', 'your used books', 'to your local libraries', 'or charities.'],
                correctAnswer: 'You can donate your used books to your local libraries or charities.',
                hint_vi: 'Động từ khuyết thiếu "can" đi với động từ nguyên mẫu.',
                rationale_vi: 'Cấu trúc: S + can + V + Tân ngữ + Giới từ/Nơi chốn. "donate (quyên góp) something to (cho) someone/something".',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['Education also helps', 'us to develop', 'our communication skills.'],
                correctAnswer: 'Education also helps us to develop our communication skills.',
                hint_vi: 'Động từ "help" đi kèm với to V hoặc V nguyên mẫu.',
                rationale_vi: 'Cấu trúc: help + tân ngữ + (to) V. Education (Giáo dục) giúp chúng ta phát triển kỹ năng giao tiếp.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['I will buy', 'some pottery', 'to make a gift', 'for my family', 'and friends.'],
                correctAnswer: 'I will buy some pottery to make a gift for my family and friends.',
                hint_vi: 'Mục đích của việc mua sắm là gì?',
                rationale_vi: 'Cấu trúc: S + will + V + Tân ngữ + to V (chỉ mục đích).',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['Tom volunteered', 'to teach English', 'in our village', 'last winter.'],
                correctAnswer: 'Tom volunteered to teach English in our village last winter.',
                hint_vi: 'Hành động xảy ra trong quá khứ ("last winter").',
                rationale_vi: 'Cấu trúc: S + volunteered + to V + Nơi chốn + Thời gian.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['Traffic jam', 'is a major problem', 'in many cities.'],
                correctAnswer: 'Traffic jam is a major problem in many cities.',
                hint_vi: 'Chủ ngữ là "Traffic jam" (Tắc đường).',
                rationale_vi: 'Cấu trúc: Chủ ngữ + to be + Bổ ngữ + Nơi chốn.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['Some scientists think', 'that there', 'were rivers', 'on Mars', 'in the past.'],
                correctAnswer: 'Some scientists think that there were rivers on Mars in the past.',
                hint_vi: 'Sử dụng cấu trúc "There was/were" cho sự tồn tại trong quá khứ.',
                rationale_vi: 'Cấu trúc: S + think that + there were + Noun (số nhiều) + Nơi chốn + Thời gian.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['They will give', 'their mother', 'a big present', 'on her birthday', 'next weekend.'],
                correctAnswer: 'They will give their mother a big present on her birthday next weekend.',
                hint_vi: 'Hành động trong tương lai ("next weekend").',
                rationale_vi: 'Cấu trúc: S + will + give + Tân ngữ 1 (người) + Tân ngữ 2 (vật) + Thời gian.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['One-third', 'of children', 'in the USA', 'are overweight.'],
                correctAnswer: 'One-third of children in the USA are overweight.',
                hint_vi: 'Chủ ngữ là phân số, động từ chia theo danh từ sau "of".',
                rationale_vi: 'Chủ ngữ "One-third of children" (danh từ số nhiều) đi với động từ "are".',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['Litter', 'can pollute', 'the water.'],
                correctAnswer: 'Litter can pollute the water.',
                hint_vi: '"Litter" (rác) là chủ ngữ.',
                rationale_vi: 'Cấu trúc: Chủ ngữ + can + V nguyên mẫu + Tân ngữ.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['You should drink', 'fruit juice', 'and water', 'every day.'],
                correctAnswer: 'You should drink fruit juice and water every day.',
                hint_vi: 'Lời khuyên về đồ uống lành mạnh.',
                rationale_vi: 'Cấu trúc: S + should + V nguyên mẫu + Tân ngữ + Thời gian.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['Many people', 'around the world', 'continue', 'to play his music.'],
                correctAnswer: 'Many people around the world continue to play his music.',
                hint_vi: 'Động từ "continue" đi với "to V" hoặc V-ing.',
                rationale_vi: 'Cấu trúc: S + continue + to V/V-ing. Trạng ngữ chỉ nơi chốn ("around the world") thường đứng giữa.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['The War Memorial of Korea', 'and Namsan Seoul Tower', 'are popular destinations', 'in Seoul.'],
                correctAnswer: 'The War Memorial of Korea and Namsan Seoul Tower are popular destinations in Seoul.',
                hint_vi: 'Chủ ngữ kép, đi với động từ số nhiều.',
                rationale_vi: 'Hai địa điểm là chủ ngữ kép, đi với động từ "are" và bổ ngữ "popular destinations".',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['Is', 'the gift', 'wrapped', 'in colorful paper?'],
                correctAnswer: 'Is the gift wrapped in colorful paper?',
                hint_vi: 'Câu hỏi ở dạng bị động.',
                rationale_vi: 'Cấu trúc câu hỏi bị động Hiện tại đơn: Is + S + V3/ed + ...?',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['My sister', 'likes playing', 'badminton.'],
                correctAnswer: 'My sister likes playing badminton.',
                hint_vi: 'Động từ "like" đi với V-ing.',
                rationale_vi: 'Cấu trúc: S + likes + V-ing + Tân ngữ.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['He goes riding', 'with his dad', 'on Sunday afternoons.'],
                correctAnswer: 'He goes riding with his dad on Sunday afternoons.',
                hint_vi: 'Thói quen lặp lại.',
                rationale_vi: 'Cấu trúc: S + V (thói quen) + with + someone + Thời gian.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['The water', 'was so', 'refreshing and cool.'],
                correctAnswer: 'The water was so refreshing and cool.',
                hint_vi: 'Câu mô tả. Tính từ đứng sau "so" (quá).',
                rationale_vi: 'Cấu trúc: S + to be + so + Tính từ.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['How old', 'will she be', 'on her next birthday?'],
                correctAnswer: 'How old will she be on her next birthday?',
                hint_vi: 'Hỏi tuổi trong tương lai.',
                rationale_vi: 'Cấu trúc: How old + will + S + be + Thời gian?',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['Sleep is very important', 'for both physical', 'and mental health.'],
                correctAnswer: 'Sleep is very important for both physical and mental health.',
                hint_vi: 'Cấu trúc "both A and B".',
                rationale_vi: 'Cấu trúc: S + to be + very important + for both + A + and + B.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ["I'm going", 'to the beach', 'with my family', 'next week.'],
                correctAnswer: "I'm going to the beach with my family next week.",
                hint_vi: 'Thì Hiện tại tiếp diễn chỉ tương lai gần.',
                rationale_vi: 'Cấu trúc Hiện tại tiếp diễn: S + to be + going to + Nơi chốn + with + someone + Thời gian.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['Each type of food', 'provides', 'different nutrients.'],
                correctAnswer: 'Each type of food provides different nutrients.',
                hint_vi: 'Chủ ngữ bắt đầu bằng "Each" chia số ít.',
                rationale_vi: 'Chủ ngữ "Each type of food" là số ít, động từ chia "provides".',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['It is not easy', 'to take photos', 'of wild animals.'],
                correctAnswer: 'It is not easy to take photos of wild animals.',
                hint_vi: 'Cấu trúc "It is + adj + to V..."',
                rationale_vi: 'Cấu trúc: It is not easy + to V + Tân ngữ.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['All of us', 'must study', 'music and dancing', 'every week.'],
                correctAnswer: 'All of us must study music and dancing every week.',
                hint_vi: 'Động từ khuyết thiếu "must" đi với V nguyên mẫu.',
                rationale_vi: 'Cấu trúc: S + must + V nguyên mẫu + Tân ngữ + Thời gian.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['She jumped', 'on a chair', 'when she', 'saw the mouse.'],
                correctAnswer: 'She jumped on a chair when she saw the mouse.',
                hint_vi: 'Hai hành động xảy ra gần như đồng thời trong quá khứ.',
                rationale_vi: 'Sử dụng thì Quá khứ đơn cho cả hai mệnh đề. Mệnh đề chính (She jumped), Mệnh đề phụ (when she saw).',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['How many kilos', 'of flour', 'do you need?'],
                correctAnswer: 'How many kilos of flour do you need?',
                hint_vi: 'Hỏi về số lượng (danh từ đếm được).',
                rationale_vi: 'Cấu trúc: How many + Danh từ số nhiều + of + Danh từ không đếm được + do/does + S + need?',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['Rossie', 'has a large', 'collection of stamps.'],
                correctAnswer: 'Rossie has a large collection of stamps.',
                hint_vi: 'Mô tả sự sở hữu.',
                rationale_vi: 'Cấu trúc: S + has + Bổ ngữ (a large collection of stamps).',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['They make noises', 'to communicate', 'with each other.'],
                correctAnswer: 'They make noises to communicate with each other.',
                hint_vi: 'Mục đích của việc tạo ra tiếng ồn là gì?',
                rationale_vi: 'Cấu trúc: S + V + Tân ngữ + to V (chỉ mục đích) + with each other.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['Can you give me', 'some suggestions', 'on a healthy', 'lifestyle?'],
                correctAnswer: 'Can you give me some suggestions on a healthy lifestyle?',
                hint_vi: 'Câu hỏi yêu cầu lời khuyên.',
                rationale_vi: 'Cấu trúc: Can you give me + Tân ngữ (some suggestions) + Giới từ (on) + Noun phrase?',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['Our club', 'cooked soup', 'for old patients.'],
                correctAnswer: 'Our club cooked soup for old patients.',
                hint_vi: 'Hành động xảy ra trong quá khứ.',
                rationale_vi: 'Cấu trúc: S + V2/ed + Tân ngữ + for + someone.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['Anna', 'was late', 'for school', 'last Monday.'],
                correctAnswer: 'Anna was late for school last Monday.',
                hint_vi: 'Sử dụng thì Quá khứ đơn.',
                rationale_vi: 'Cấu trúc: S + was + late for + Nơi chốn + Thời gian.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ["I'm going", 'to the church', 'with my mother', 'next Sunday.'],
                correctAnswer: "I'm going to the church with my mother next Sunday.",
                hint_vi: 'Thì Hiện tại tiếp diễn chỉ tương lai gần.',
                rationale_vi: 'Cấu trúc Hiện tại tiếp diễn: S + to be + V-ing + to + Nơi chốn + with + someone + Thời gian.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['Does he', 'go to school', 'every day?'],
                correctAnswer: 'Does he go to school every day?',
                hint_vi: 'Câu hỏi Hiện tại đơn.',
                rationale_vi: 'Cấu trúc câu hỏi Hiện tại đơn: Does + S + V nguyên mẫu + ...?',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['Does your mother', 'enjoy', 'doing yoga?'],
                correctAnswer: 'Does your mother enjoy doing yoga?',
                hint_vi: 'Động từ "enjoy" đi với V-ing.',
                rationale_vi: 'Cấu trúc câu hỏi Hiện tại đơn với động từ "enjoy" theo sau là V-ing.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['How far is it', 'from here', 'to the nearest', 'bus stop?'],
                correctAnswer: 'How far is it from here to the nearest bus stop?',
                hint_vi: 'Hỏi khoảng cách từ đây đến đâu.',
                rationale_vi: 'Cấu trúc: How far is it + from + Nơi chốn 1 + to + Nơi chốn 2?',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['Jane', 'never eats', 'this kind', 'of food.'],
                correctAnswer: 'Jane never eats this kind of food.',
                hint_vi: 'Trạng từ tần suất "never" đứng trước động từ thường.',
                rationale_vi: 'Cấu trúc: S + Trạng từ tần suất + V + Tân ngữ.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['We would also eat', 'delicious seafood', 'at local restaurants.'],
                correctAnswer: 'We would also eat delicious seafood at local restaurants.',
                hint_vi: 'Câu mô tả thói quen/hành động trong quá khứ/tương lai (với "would").',
                rationale_vi: 'Cấu trúc: S + would + also + V nguyên mẫu + Tân ngữ + Nơi chốn.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['This tea', "doesn't taste", 'the same', 'as the one', 'I usually drink.'],
                correctAnswer: "This tea doesn't taste the same as the one I usually drink.",
                hint_vi: 'Sử dụng cấu trúc so sánh.',
                rationale_vi: 'Cấu trúc "doesn\'t taste the same as" (không có vị giống như) để so sánh.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['I think', 'you should', 'have your hair', 'cut.'],
                correctAnswer: 'I think you should have your hair cut.',
                hint_vi: 'Cấu trúc nhờ ai làm gì (causative form).',
                rationale_vi: 'Cấu trúc: S + should + have + Tân ngữ + V3/ed.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['We sit', 'in front of the fire', 'and read', 'Christmas stories', 'on Christmas Eve.'],
                correctAnswer: 'We sit in front of the fire and read Christmas stories on Christmas Eve.',
                hint_vi: 'Hai hành động song song, thói quen vào dịp Giáng sinh.',
                rationale_vi: 'Cấu trúc: S + V1 (sit) + Giới từ + and + V2 (read) + Tân ngữ + Thời gian.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['They said', 'music helps', 'students concentrate', 'better.'],
                correctAnswer: 'They said music helps students concentrate better.',
                hint_vi: 'Mệnh đề phụ sau "said".',
                rationale_vi: 'Cấu trúc: S + said that + Mệnh đề phụ. Cấu trúc: help + Tân ngữ + V nguyên mẫu.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['A lot of important', 'inventions', 'are carried out', 'by scientists.'],
                correctAnswer: 'A lot of important inventions are carried out by scientists.',
                hint_vi: 'Câu bị động.',
                rationale_vi: 'Cấu trúc câu bị động Hiện tại đơn: S + are + V3/ed (carried out) + by + Tác nhân.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['I did', 'a lot of fun things', 'and spent time', 'with my loved ones.'],
                correctAnswer: 'I did a lot of fun things and spent time with my loved ones.',
                hint_vi: 'Hai hành động trong quá khứ ("did" và "spent").',
                rationale_vi: 'Hai hành động quá khứ được nối bằng "and".',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['Unfortunately,', 'the film', 'got unfavored', 'reviews.'],
                correctAnswer: 'Unfortunately, the film got unfavored reviews.',
                hint_vi: 'Sử dụng trạng từ đầu câu.',
                rationale_vi: 'Trạng từ (Unfortunately) + Mệnh đề chính: S + V + Tân ngữ.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['They went to bed', 'really early', 'when they', 'were little.'],
                correctAnswer: 'They went to bed really early when they were little.',
                hint_vi: 'Hành động xảy ra trong quá khứ ("when they were little").',
                rationale_vi: 'Cả hai mệnh đề đều phải ở thì Quá khứ đơn (They went to bed... when they were little).',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['Environmental pollution', 'is one of', 'the most serious problems', 'today.'],
                correctAnswer: 'Environmental pollution is one of the most serious problems today.',
                hint_vi: 'Cấu trúc so sánh nhất.',
                rationale_vi: 'Cấu trúc: S + is one of the most + Tính từ + Danh từ số nhiều + Thời gian.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['She didn\'t', 'get on well', 'with her boss,', 'so she left', 'the company.'],
                correctAnswer: "She didn't get on well with her boss, so she left the company.",
                hint_vi: 'Nguyên nhân và kết quả được nối bằng "so".',
                rationale_vi: 'Cấu trúc: Nguyên nhân + so + Kết quả.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['There are some', 'expensive new flats', 'next to', 'the river.'],
                correctAnswer: 'There are some expensive new flats next to the river.',
                hint_vi: 'Cấu trúc "There are" chỉ sự tồn tại.',
                rationale_vi: 'Cấu trúc: There are + Danh từ số nhiều + Giới từ chỉ vị trí.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['Although he had', 'a good salary,', 'he was unhappy', 'in his job.'],
                correctAnswer: 'Although he had a good salary, he was unhappy in his job.',
                hint_vi: 'Liên từ chỉ sự tương phản.',
                rationale_vi: 'Cấu trúc: Although + Mệnh đề 1, Mệnh đề 2 (Mệnh đề 2 tương phản với Mệnh đề 1).',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['Hoa works', 'very hard,', 'so she always', 'gets good marks.'],
                correctAnswer: 'Hoa works very hard, so she always gets good marks.',
                hint_vi: 'Nguyên nhân và kết quả được nối bằng "so".',
                rationale_vi: 'Cấu trúc: Nguyên nhân + so + Kết quả.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['He talked', 'as if', 'he knew', 'where she was.'],
                correctAnswer: 'He talked as if he knew where she was.',
                hint_vi: 'Cấu trúc "as if" (như thể là).',
                rationale_vi: 'Cấu trúc: S + V + as if + S + V2/ed (dùng để diễn tả điều không có thật hoặc không chắc chắn).',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['You can join', 'one of these', 'two projects.'],
                correctAnswer: 'You can join one of these two projects.',
                hint_vi: 'Động từ khuyết thiếu "can" đi với V nguyên mẫu.',
                rationale_vi: 'Cấu trúc: S + can + V + Tân ngữ. "one of these two projects" (một trong hai dự án này).',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['Here you can see', 'some pictures', 'of our summer activities.'],
                correctAnswer: 'Here you can see some pictures of our summer activities.',
                hint_vi: 'Sử dụng trạng từ đầu câu.',
                rationale_vi: 'Cấu trúc: Here + S + can + V + Tân ngữ.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['Water puppetry', 'began', 'in the 11th century.'],
                correctAnswer: 'Water puppetry began in the 11th century.',
                hint_vi: 'Hành động xảy ra trong quá khứ.',
                rationale_vi: 'Cấu trúc: S + V2/ed + Thời gian.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['Volunteering', 'is a great way', 'for families', 'to have fun', 'and feel closer.'],
                correctAnswer: 'Volunteering is a great way for families to have fun and feel closer.',
                hint_vi: 'Danh động từ làm chủ ngữ.',
                rationale_vi: 'Cấu trúc: Danh động từ (Volunteering) + to be + Noun phrase + for + someone + to V.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['I am a kind,', 'hard-working, patient,', 'and very nice', 'person.'],
                correctAnswer: 'I am a kind, hard-working, patient, and very nice person.',
                hint_vi: 'Liệt kê các tính từ mô tả. (Giả định thêm "nice").',
                rationale_vi: 'Cấu trúc liệt kê tính từ: S + to be + a + adj1, adj2, and adj3 + Noun. (Giả định thêm "nice" để hoàn thành câu).',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['You should look', 'right and left', 'when you go', 'across the road.'],
                correctAnswer: 'You should look right and left when you go across the road.',
                hint_vi: 'Lời khuyên khi băng qua đường.',
                rationale_vi: 'Cấu trúc: S + should + V + Tân ngữ + when + Mệnh đề phụ.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['Last year', 'more than 150,000 people', 'went to the Tramlines', 'free music festival', 'in Sheffield.'],
                correctAnswer: 'Last year more than 150,000 people went to the Tramlines free music festival in Sheffield.',
                hint_vi: 'Hành động xảy ra trong quá khứ.',
                rationale_vi: 'Cấu trúc: Thời gian + S + V2/ed + Tân ngữ + Nơi chốn.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['There are', 'music festivals', 'across Britain', 'every year', 'that are completely free of charge.'],
                correctAnswer: 'There are music festivals across Britain every year that are completely free of charge.',
                hint_vi: 'Cấu trúc "There are" và mệnh đề quan hệ.',
                rationale_vi: 'Cấu trúc: There are + Noun + Nơi chốn + Thời gian + Mệnh đề quan hệ.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['The dance is not', 'as difficult as', 'the song, but', 'they still rehearse', 'very hard.'],
                correctAnswer: 'The dance is not as difficult as the song, but they still rehearse very hard.',
                hint_vi: 'So sánh không bằng và liên từ tương phản "but".',
                rationale_vi: 'Cấu trúc: S + is not as + adj + as + Noun, but + Mệnh đề 2.',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['I hope', 'you don\'t mind', 'telephoning me', 'so late at night.'],
                correctAnswer: 'I hope you don\'t mind telephoning me so late at night.',
                hint_vi: 'Động từ "mind" đi với V-ing.',
                rationale_vi: 'Cấu trúc: S + hope + S + V (mệnh đề). Cấu trúc "mind + V-ing".',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['Can you play', 'the piano', 'without having', 'lots of practice first?'],
                correctAnswer: 'Can you play the piano without having lots of practice first?',
                hint_vi: 'Giới từ "without" đi với V-ing.',
                rationale_vi: 'Cấu trúc: Can you V + Tân ngữ + without + V-ing + ...?',
            },
            {
                type: 'rearrange',
                question: 'Sắp xếp các từ/cụm từ sau thành câu đúng:',
                words: ['The sculpture', 'on the kitchen', 'windowsill', 'creates', 'a sense of joy.'],
                correctAnswer: 'The sculpture on the kitchen windowsill creates a sense of joy.',
                hint_vi: 'Chủ ngữ là "The sculpture on the kitchen windowsill".',
                rationale_vi: 'Cấu trúc: Chủ ngữ + V (số ít) + Tân ngữ.',
            },
            
            // --- Part 3: Fill in the blank (20 questions) ---
            {
                type: 'fill-in-the-blank',
                question: 'Give the correct comparative form: busy -> ____',
                correctAnswer: 'busier',
                hint_vi: 'Tính từ hai âm tiết kết thúc bằng -y chuyển thành so sánh hơn.',
                rationale_vi: 'Dạng so sánh hơn của "busy" là "busier" (thay y bằng i và thêm er).',
            },
            {
                type: 'fill-in-the-blank',
                question: 'Play music if you like. But don\'t play it too ____.',
                correctAnswer: 'loudly',
                hint_vi: 'Cần một trạng từ bổ nghĩa cho động từ "play".',
                rationale_vi: 'Trạng từ "loudly" (quá to) bổ nghĩa cho động từ "play".',
            },
            {
                type: 'fill-in-the-blank',
                question: 'Hoan Kiem Lake is a his____ place in Hanoi.',
                correctAnswer: 'historic',
                hint_vi: 'Tính từ mô tả một địa điểm có ý nghĩa lịch sử.',
                rationale_vi: 'Tính từ "historic" (mang tính lịch sử) mô tả "place".',
            },
            {
                type: 'fill-in-the-blank',
                question: 'Give the correct comparative form: angry -> ____',
                correctAnswer: 'angrier',
                hint_vi: 'Tính từ hai âm tiết kết thúc bằng -y chuyển thành so sánh hơn.',
                rationale_vi: 'Dạng so sánh hơn của "angry" là "angrier" (thay y bằng i và thêm er).',
            },
            {
                type: 'fill-in-the-blank',
                question: 'Some scientists think that there ____ rivers on Mars in the past.',
                correctAnswer: 'were',
                hint_vi: 'Sử dụng cấu trúc "There was/were" cho sự tồn tại trong quá khứ (số nhiều).',
                rationale_vi: 'Vì "rivers" là số nhiều và bối cảnh là "in the past", dùng "were".',
            },
            {
                type: 'fill-in-the-blank',
                question: 'Give the correct form of the word in brackets: Painting pictures helps her improve her ____ (CREATE).',
                correctAnswer: 'creativity',
                hint_vi: 'Cần một danh từ sau sở hữu cách ("her").',
                rationale_vi: 'Danh từ của "CREATE" (sáng tạo) là "creativity" (sự sáng tạo).',
            },
            {
                type: 'fill-in-the-blank',
                question: 'Let\'s ____ a look at the film section of the paper.',
                correctAnswer: 'have',
                hint_vi: 'Động từ trong cụm từ "have a look" (nhìn vào).',
                rationale_vi: 'Cấu trúc "Let\'s + V nguyên mẫu". Cụm từ là "have a look".',
            },
            {
                type: 'fill-in-the-blank',
                question: 'You should be ____ , especially when you cross the road. (CARE)',
                correctAnswer: 'careful',
                hint_vi: 'Cần một tính từ sau "to be".',
                rationale_vi: 'Tính từ của "CARE" là "careful" (cẩn thận).',
            },
            {
                type: 'fill-in-the-blank',
                question: 'You should play sports or do exercise to stay in ____.',
                correctAnswer: 'shape',
                hint_vi: 'Cụm từ có nghĩa là giữ dáng/khỏe mạnh ("stay in...").',
                rationale_vi: 'Cụm từ "stay in shape" (giữ dáng/khỏe mạnh).',
            },
            {
                type: 'fill-in-the-blank',
                question: 'The six parts of the food pyramid have dif____ sizes.',
                correctAnswer: 'different',
                hint_vi: 'Cần một tính từ bổ nghĩa cho "sizes".',
                rationale_vi: 'Tính từ "different" (khác nhau) bổ nghĩa cho danh từ "sizes".',
            },
            {
                type: 'fill-in-the-blank',
                question: 'Give the correct form of the word in brackets: How many ____ in one football team? (PLAY)',
                correctAnswer: 'players',
                hint_vi: 'Cần một danh từ đếm được số nhiều.',
                rationale_vi: 'Danh từ số nhiều của "PLAY" là "players" (cầu thủ).',
            },
            {
                type: 'fill-in-the-blank',
                question: 'I think going to university is a good prepa____ for your future career.',
                correctAnswer: 'preparation',
                hint_vi: 'Cần một danh từ sau "a good".',
                rationale_vi: 'Danh từ của "prepare" (chuẩn bị) là "preparation" (sự chuẩn bị).',
            },
            {
                type: 'fill-in-the-blank',
                question: 'My sister has ____ clothes and books for poor people.',
                correctAnswer: 'donated',
                hint_vi: 'Hành động đã xảy ra và dùng cho Hiện tại hoàn thành (have + V3/ed).',
                rationale_vi: 'Động từ ở thì Hiện tại hoàn thành: "has donated" (đã quyên góp).',
            },
            {
                type: 'fill-in-the-blank',
                question: 'Give the correct form of the word in brackets: Rob has a ____ and he needs to rest more. (HEAD)',
                correctAnswer: 'headache',
                hint_vi: 'Cần một danh từ chỉ bệnh, bắt đầu bằng "HEAD".',
                rationale_vi: 'Danh từ chỉ bệnh là "headache" (đau đầu).',
            },
            {
                type: 'fill-in-the-blank',
                question: 'Thou____ of fans lined up in the middle of the night to welcome Argentina team after the 2022 World Cup victory.',
                correctAnswer: 'thousands',
                hint_vi: 'Chỉ một số lượng lớn (hàng ngàn).',
                rationale_vi: 'Cụm từ "thousands of fans" (hàng ngàn người hâm mộ).',
            },
            {
                type: 'fill-in-the-blank',
                question: 'The whale shark is the biggest ____ in the ocean.',
                correctAnswer: 'animal',
                hint_vi: 'Danh từ chỉ loài vật.',
                rationale_vi: 'Cá voi là loài "animal" (động vật) lớn nhất đại dương.',
            },
            {
                type: 'fill-in-the-blank',
                question: 'My mother always prepares food and drink for us. Her hobby is ____.',
                correctAnswer: 'cooking',
                hint_vi: 'Sở thích liên quan đến việc chuẩn bị thức ăn.',
                rationale_vi: 'Sở thích của cô ấy là "cooking" (nấu ăn).',
            },
            {
                type: 'fill-in-the-blank',
                question: 'Edison\'s most famous ____ was the electric bulb. (INVENT)',
                correctAnswer: 'invention',
                hint_vi: 'Cần danh từ chỉ phát minh.',
                rationale_vi: 'Danh từ của "INVENT" là "invention" (phát minh).',
            },
            {
                type: 'fill-in-the-blank',
                question: 'Chinese people in____ed chopsticks about 5000 years ago.',
                correctAnswer: 'invented',
                hint_vi: 'Hành động xảy ra trong quá khứ ("5000 years ago").',
                rationale_vi: 'Sử dụng thì Quá khứ đơn: "invented" (đã phát minh).',
            },
            {
                type: 'fill-in-the-blank',
                question: 'The houseboats has solar panels on the top of the house to ge____ electricity.',
                correctAnswer: 'generate',
                hint_vi: 'Động từ có nghĩa là tạo ra (điện).',
                rationale_vi: 'Động từ "generate" (tạo ra) electricity (điện).',
            },
        ];

        // --- State Management (Dữ liệu toàn cục) ---
        let gameState = 'start';
        let playerName = '';
        let score = 0;
        let shuffledQuestions = [];
        let currentQuestionIndex = 0;
        let isAnswered = false;
        let scoredThisQuestion = false;
        let isCorrect = false;
        let submittedAnswer = '';
        let message = null;

        const appRoot = document.querySelector('#app-root > div');

        // --- Utility Functions ---

        /**
         * Hàm xáo trộn mảng câu hỏi (Fisher-Yates)
         * @param {Array<Object>} array 
         * @returns {Array<Object>} Mảng đã xáo trộn
         */
        function shuffleArray(array) {
            let newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        /**
         * Hiển thị thông báo (MessageBox)
         * @param {string} text Nội dung thông báo
         * @param {string} type Loại thông báo ('success', 'error', 'info')
         */
        function showMessage(text, type) {
            message = { text, type };
            renderApp();
            setTimeout(() => {
                // Chỉ xóa nội dung message, nhưng không render lại ngay để RationaleBox không bị nhấp nháy
                message = null; 
            }, 3000); 
        }
        
        /**
         * Xóa MessageBox đang hiển thị trên DOM
         */
        function clearMessageBox() {
            let oldMsg = document.getElementById('message-box-container');
            if(oldMsg) oldMsg.remove();
            message = null;
        }


        /**
         * Lấy HTML cho MessageBox
         */
        function renderMessageBox() {
            if (!message) return '';

            const baseClasses = "fixed top-4 left-1/2 -translate-x-1/2 p-4 rounded-xl border-b-4 shadow-2xl text-center font-semibold text-lg z-50 transition-all ease-in-out duration-500 transform w-11/12 max-w-md";
            
            const typeClasses = {
                success: 'bg-green-50 border-green-600 text-green-800',
                error: 'bg-red-50 border-red-600 text-red-800',
                info: 'bg-yellow-100 border-yellow-500 text-yellow-800', 
            };

            const messageHtml = `
                <div class="${baseClasses} ${typeClasses[message.type]} opacity-100 scale-100 translate-y-0">
                    ${message.text}
                </div>
            `;
            
            // Tìm và xóa message cũ nếu có
            let oldMsg = document.getElementById('message-box-container');
            if(oldMsg) oldMsg.remove();

            // Thêm message mới
            let container = document.createElement('div');
            container.id = 'message-box-container';
            container.innerHTML = messageHtml;
            document.body.appendChild(container);
        }
        
        /**
         * Lấy HTML cho ProgressBar
         * @param {number} percentage 
         */
        function renderProgressBar(percentage) {
            return `
                <div class="w-full h-2 bg-blue-100 rounded-full mt-4 overflow-hidden">
                    <div
                        class="h-full bg-blue-500 transition-all duration-500 ease-in-out"
                        style="width: ${percentage}%;"
                    ></div>
                </div>
            `;
        }

        /**
         * Lấy HTML cho RationaleBox
         * @param {Object} question
         * @param {boolean} isCorrect
         * @param {string} submittedAnswer
         */
        function renderRationaleBox(question, isCorrect, submittedAnswer) {
            const boxClasses = `mt-6 p-4 rounded-lg border transition duration-300 fade-in border-l-4 ${
                isCorrect ? 'bg-green-100 border-green-600' : 'bg-red-100 border-red-600'
            }`;

            let submittedDisplay = '';
            if (!isCorrect || question.type === 'fill-in-the-blank') {
                submittedDisplay = `
                    <strong>${question.type === 'mc' ? 'Bạn đã chọn: ' : 'Câu trả lời của bạn: '}</strong>
                    <span class="text-red-700 font-medium">${submittedAnswer}</span>
                    <br/>
                `;
            }

            return `
                <div id="rationale-box" class="${boxClasses}">
                    <p class="font-bold text-lg mb-2 text-blue-700">Giải thích (Rationale):</p>
                    <div class="text-gray-700">
                        ${submittedDisplay}
                        <strong>Đáp án đúng:</strong> ${question.correctAnswer} <br />
                        ${question.rationale_vi}
                    </div>
                </div>
            `;
        }

        // --- Core Logic ---

        function handleStartQuiz(name) {
            playerName = name;
            score = 0;
            currentQuestionIndex = 0;
            shuffledQuestions = shuffleArray(questions);
            gameState = 'quiz';
            renderApp();
        }

        function handleEndQuiz() {
            gameState = 'end';
            renderApp();
        }

        function handleRestartQuiz() {
            playerName = '';
            score = 0;
            currentQuestionIndex = 0;
            gameState = 'start';
            renderApp();
        }

        function handleSubmit(answer, isAnswerCorrect) {
            if (isAnswered) return;
            
            isAnswered = true;
            submittedAnswer = answer;
            isCorrect = isAnswerCorrect;

            if (isAnswerCorrect && !scoredThisQuestion) {
                score += 10;
                scoredThisQuestion = true;
                showMessage('CHÍNH XÁC! +10 điểm. Tuyệt vời!', 'success');
            } else if (isAnswerCorrect && scoredThisQuestion) {
                showMessage('CHÍNH XÁC! Nhưng điểm đã được tính rồi.', 'info');
            } else {
                showMessage('SAI RỒI! Vui lòng xem giải thích và học hỏi.', 'error');
            }
            renderApp();
        }

        function handleNext() {
            // Dọn dẹp trước khi chuyển câu hỏi
            clearMessageBox(); 
            // Xóa RationaleBox trên DOM
            const rationaleBox = document.getElementById('rationale-box');
            if(rationaleBox) rationaleBox.remove();
            
            if (currentQuestionIndex < shuffledQuestions.length - 1) {
                currentQuestionIndex++;
                isAnswered = false;
                scoredThisQuestion = false;
                isCorrect = false;
                submittedAnswer = '';
                renderApp();
            } else {
                handleEndQuiz();
            }
        }
        
        // --- Render Components (as HTML strings) ---

        function renderStartScreen() {
            return `
                <div class="fade-in text-center">
                    <header class="mb-8">
                        <h1 class="text-3xl sm:text-4xl font-extrabold text-blue-600 mb-2">Bài Thi Thử IOE Lớp 7</h1>
                        <p class="text-lg text-gray-500">Trắc nghiệm, Sắp xếp câu & Điền từ Tiếng Anh</p>
                    </header>
                    <div class="max-w-md mx-auto">
                        <h2 class="text-2xl font-semibold mb-4">Chào mừng đến với bài thi!</h2>
                        <p class="text-gray-600 mb-6">Mỗi câu trả lời đúng lần đầu được cộng 10 điểm. Tổng cộng ${questions.length} câu.</p>
                        <div class="space-y-4">
                            <label for="player-name" class="block text-sm font-medium text-gray-700 text-left">Nhập tên của bạn để bắt đầu:</label>
                            <input
                                type="text"
                                id="player-name"
                                placeholder="Tên người chơi"
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-lg shadow-sm"
                                maxlength="50"
                                value="${playerName}"
                            />
                            <button
                                id="start-button"
                                class="w-full py-3 px-4 bg-blue-500 text-white font-bold rounded-lg shadow-md transition duration-300 hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-xl"
                            >
                                Bắt Đầu Thi
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function setupStartScreenListeners() {
            const nameInput = document.getElementById('player-name');
            const startButton = document.getElementById('start-button');

            if (!nameInput || !startButton) return;

            const updateButtonState = () => {
                startButton.disabled = nameInput.value.trim() === '';
            };

            nameInput.addEventListener('input', updateButtonState);
            startButton.addEventListener('click', () => {
                const name = nameInput.value.trim();
                if (name) handleStartQuiz(name);
            });
            nameInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && nameInput.value.trim() !== '') {
                    startButton.click();
                }
            });
            updateButtonState();
        }

        function renderEndScreen() {
            const finalScore = score;
            const totalQuestions = questions.length;
            const maxScore = totalQuestions * 10;
            const percentage = Math.round((finalScore / maxScore) * 100);
            
            return `
                <div class="text-center fade-in">
                    <h2 class="text-3xl font-bold mb-4 text-green-600">🎉 Hoàn Thành Bài Thi! 🎉</h2>
                    <p class="text-xl text-gray-700 mb-6">
                        Chúc mừng, <span class="font-extrabold text-blue-600">${playerName}</span>!
                    </p>
                    <div class="mb-8 bg-blue-50 p-6 rounded-lg shadow-inner">
                        <p class="text-2xl font-semibold mb-2 text-gray-800">Điểm số cuối cùng của bạn là:</p>
                        <p class="text-6xl font-black text-red-700 mb-4">${finalScore}</p>
                        <p class="text-lg text-gray-600">
                            Đạt được ${score}/${maxScore} x 100% = ${percentage}% số điểm tối đa
                        </p>
                    </div>
                    <button
                        id="restart-button"
                        class="py-3 px-6 bg-blue-500 text-white font-bold rounded-lg shadow-lg transition duration-300 hover:bg-blue-600 text-lg"
                    >
                        Làm lại bài thi
                    </button>
                </div>
            `;
        }

        function setupEndScreenListeners() {
            document.getElementById('restart-button')?.addEventListener('click', handleRestartQuiz);
        }

        // --- Question Type Renderers ---

        function renderMultipleChoiceQuestion(question, index) {
            let optionsHtml = question.options.map((option, i) => {
                const isSelected = submittedAnswer === option.text;
                let labelClasses = "block p-4 border-2 border-gray-200 rounded-lg shadow-sm text-lg transition duration-200";

                if (isAnswered) {
                    labelClasses += " cursor-default";
                    if (option.isCorrect) {
                        labelClasses += " bg-green-100 border-green-500 font-bold";
                    } else if (isSelected) {
                        labelClasses += " bg-red-100 border-red-500 font-bold";
                    } else {
                        labelClasses += " text-gray-400";
                    }
                } else {
                    labelClasses += " cursor-pointer hover:bg-blue-50 hover:border-blue-300";
                    if(isSelected) {
                        labelClasses += " bg-blue-100 border-blue-500";
                    }
                }
                
                // Sử dụng data-index thay vì input radio
                return `
                    <div class="relative">
                        <label 
                            class="${labelClasses} mc-option" 
                            data-text="${option.text}" 
                            data-index="${i}" 
                            data-correct="${option.isCorrect}"
                            ${isAnswered ? 'style="pointer-events: none;"' : ''}
                        >
                            <span class="font-mono mr-2 font-bold text-gray-500">${String.fromCharCode(65 + i)}.</span>
                            ${option.text}
                        </label>
                    </div>
                `;
            }).join('');

            return `
                <h3 class="text-xl sm:text-2xl font-semibold mb-6 leading-relaxed">
                    ${index + 1}. ${question.question}
                </h3>
                <div class="space-y-3">
                    ${optionsHtml}
                </div>
                <button
                    id="submit-mc"
                    ${isAnswered ? 'disabled' : ''}
                    class="w-full py-2 px-4 bg-green-600 text-white font-semibold rounded-lg shadow-md transition duration-300 hover:bg-green-700 mt-4 disabled:bg-gray-400 disabled:cursor-not-allowed"
                >
                    Kiểm Tra Câu Trả Lời
                </button>
            `;
        }
        
        function setupMultipleChoiceListeners(question) {
            const submitButton = document.getElementById('submit-mc');
            const options = document.querySelectorAll('.mc-option');
            let selectedOption = null;

            options.forEach(option => {
                if (!isAnswered) {
                    option.addEventListener('click', function() {
                        options.forEach(o => o.classList.remove('bg-blue-100', 'border-blue-500'));
                        this.classList.add('bg-blue-100', 'border-blue-500');
                        selectedOption = {
                            text: this.dataset.text,
                            isCorrect: this.dataset.correct === 'true'
                        };
                    });
                }
            });

            submitButton?.addEventListener('click', () => {
                if (!selectedOption) {
                    showMessage('Vui lòng chọn một đáp án trước khi kiểm tra!', 'info');
                    return;
                }
                handleSubmit(selectedOption.text, selectedOption.isCorrect);
            });
        }


        function renderFillInTheBlankQuestion(question, index) {
            const placeholder = '____';
            let beforeText = question.question;
            let afterText = '';

            // Handle questions asking for the correct form of a word in brackets (Part 3 of PDF)
            const formMatch = question.question.match(/([^_]*)____ \(([^)]+)\)\.?/);
            if (formMatch) {
                beforeText = formMatch[1].trim();
                afterText = `( ${formMatch[2].trim()} )`;
            } else if (question.question.includes(placeholder)) {
                const parts = question.question.split(placeholder);
                beforeText = parts[0].trim();
                afterText = parts[1] ? parts[1].trim() : '';
            }

            let inputClasses = 'inline-block mx-2 p-2 border-2 rounded-lg text-lg text-center shadow-sm transition duration-200 align-baseline w-32 sm:w-48';
            if (isAnswered) {
                const isSubmissionCorrect = submittedAnswer.toLowerCase() === question.correctAnswer.toLowerCase();
                inputClasses += isSubmissionCorrect ? ' border-green-500 bg-green-50' : ' border-red-500 bg-red-50';
            } else {
                inputClasses += ' border-gray-300 focus:border-blue-500';
            }

            return `
                <div class="space-y-4">
                    <div class="text-xl sm:text-2xl font-semibold mb-6 leading-relaxed flex justify-center items-center flex-wrap text-center">
                        <span>${index + 1}. </span>
                        ${beforeText && `<span class="ml-1">${beforeText}</span>`}
                        <input
                            type="text"
                            id="fill-in-input"
                            value="${isAnswered ? submittedAnswer : ''}"
                            ${isAnswered ? 'disabled' : ''}
                            placeholder="Điền từ"
                            class="${inputClasses}"
                            aria-label="Fill in the blank"
                        />
                        ${afterText && `<span>${afterText}</span>`}
                    </div>
                    <button
                        id="submit-fill"
                        ${isAnswered ? 'disabled' : ''}
                        class="w-full py-2 px-4 bg-green-600 text-white font-semibold rounded-lg shadow-md transition duration-300 hover:bg-green-700 mt-4 disabled:bg-gray-400 disabled:cursor-not-allowed"
                    >
                        Kiểm Tra Câu Trả Lời
                    </button>
                </div>
            `;
        }

        function setupFillInTheBlankListeners(question) {
            const inputElement = document.getElementById('fill-in-input');
            const submitButton = document.getElementById('submit-fill');

            const submitHandler = () => {
                const trimmedInput = inputElement.value.trim().replace(/\s+/g, ' ');
                if (trimmedInput === '') {
                    showMessage('Vui lòng điền câu trả lời của bạn!', 'info');
                    return;
                }
                const isCorrect = trimmedInput.toLowerCase() === question.correctAnswer.toLowerCase();
                handleSubmit(trimmedInput, isCorrect);
            };

            submitButton?.addEventListener('click', submitHandler);
            inputElement?.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !isAnswered) {
                    submitHandler();
                }
            });

            // Gán lại giá trị submittedAnswer sau khi render nếu đã trả lời
            if (isAnswered) {
                inputElement.value = submittedAnswer;
            }
        }
        
        /**
         * Tạo HTML cho một Word Block (dùng chung cho cả sentence và source)
         * @param {Object} word 
         * @param {boolean} isSource 
         * @param {boolean} isAnswered 
         * @param {string} action 
         */
        function createWordBlockHtml(word, isSource, isAnswered, action) {
            const baseClasses = 'word-block px-3 py-2 font-semibold rounded-lg shadow-sm transition-all duration-150 break-words';
            const sourceClasses = isSource ? 'bg-blue-100 text-blue-800 hover:bg-blue-200' : 'bg-gray-100 text-gray-800';
            const disabledClasses = isAnswered ? 'disabled' : '';
            
            return `
                <span 
                    class="${baseClasses} ${sourceClasses} ${disabledClasses}"
                    data-id="${word.id}" 
                    data-text="${word.text}"
                    data-action="${action}"
                >
                    ${word.text}
                </span>
            `;
        }

        /**
         * Cập nhật DOM cục bộ cho các khối từ (Rearrange Question)
         * @param {Array} sentenceWords 
         * @param {Array} sourceWords 
         * @param {boolean} isAnswered 
         */
        function updateRearrangeUI(sentenceWords, sourceWords, isAnswered) {
            const sentenceArea = document.getElementById('sentence-area');
            const sourceBank = document.getElementById('source-bank');

            if (!sentenceArea || !sourceBank) return;

            // 1. Cập nhật Sentence Area
            if (sentenceWords.length === 0 && !isAnswered) {
                sentenceArea.innerHTML = `<span class="text-gray-500 italic text-sm">Xây dựng câu trả lời tại đây...</span>`;
            } else {
                const sentenceHtml = sentenceWords.map(word => 
                    createWordBlockHtml(word, false, isAnswered, 'return')
                ).join('');
                sentenceArea.innerHTML = sentenceHtml;
            }

            // 2. Cập nhật Source Bank
            const sourceHtml = sourceWords.map(word => 
                createWordBlockHtml(word, true, isAnswered, 'select')
            ).join('');
            sourceBank.innerHTML = sourceHtml;
        }

        function renderRearrangeQuestion(question, index) {
            // Khởi tạo/tải lại trạng thái từ/ngân hàng từ
            let sentenceWords = [];
            let sourceWords = [...question.words];
            
            if (isAnswered) {
                // Nếu đã trả lời, chỉ hiển thị kết quả cuối cùng (không cần logic state phức tạp)
                sentenceWords = submittedAnswer.split(' ').map((text, id) => ({ id: Date.now() + id, text }));
                sourceWords = [];
            } else {
                const storedState = JSON.parse(sessionStorage.getItem('rearrangeState')) || {};
                
                if (storedState.questionIndex === index && storedState.words) {
                    sentenceWords = storedState.words.sentence;
                    sourceWords = storedState.words.source;
                } else {
                    // Xáo trộn lần đầu nếu không có trạng thái lưu
                    const initialWords = question.words.map((text, id) => ({ id: Date.now() + id, text }));
                    sourceWords = shuffleArray(initialWords);
                    
                    // Lưu trạng thái ban đầu để render và cho listeners
                    sessionStorage.setItem('rearrangeState', JSON.stringify({
                        questionIndex: index,
                        words: { sentence: [], source: sourceWords }
                    }));
                }
            }

            const initialSentenceHtml = sentenceWords.length === 0 && !isAnswered ? 
                `<span class="text-gray-500 italic text-sm">Xây dựng câu trả lời tại đây...</span>` :
                sentenceWords.map(word => createWordBlockHtml(word, false, isAnswered, 'return')).join('');

            const initialSourceHtml = sourceWords.map(word => createWordBlockHtml(word, true, isAnswered, 'select')).join('');

            return `
                <h3 class="text-xl sm:text-2xl font-semibold mb-6 leading-relaxed">
                    ${index + 1}. ${question.question}
                </h3>
                <div class="space-y-4">
                    <div id="sentence-area" class="min-h-[60px] p-3 border-2 border-dashed border-blue-300 rounded-lg bg-blue-50 shadow-inner flex flex-wrap gap-2 items-center">
                        ${initialSentenceHtml}
                    </div>
                    <div id="source-bank" class="min-h-[100px] p-4 bg-gray-100 rounded-lg shadow-md flex flex-wrap gap-2 items-center border border-gray-200">
                        ${initialSourceHtml}
                    </div>
                    <button
                        id="submit-rearrange"
                        ${isAnswered ? 'disabled' : ''}
                        class="w-full py-2 px-4 bg-green-600 text-white font-semibold rounded-lg shadow-md transition duration-300 hover:bg-green-700 mt-4 disabled:bg-gray-400 disabled:cursor-not-allowed"
                    >
                        Kiểm Tra Câu Trả Lời
                    </button>
                </div>
            `;
        }

        function setupRearrangeListeners(question) {
            if (isAnswered) return;

            // Load words state
            let state = JSON.parse(sessionStorage.getItem('rearrangeState'));
            if (!state || state.questionIndex !== currentQuestionIndex) {
                // Should not happen if rendering logic is correct, but safety guard
                return;
            }

            let sentenceWords = state.words.sentence;
            let sourceWords = state.words.source;
            
            const sentenceArea = document.getElementById('sentence-area');
            const sourceBank = document.getElementById('source-bank');
            const submitButton = document.getElementById('submit-rearrange');

            const saveStateAndRefreshUI = () => {
                 sessionStorage.setItem('rearrangeState', JSON.stringify({
                    questionIndex: currentQuestionIndex,
                    words: { sentence: sentenceWords, source: sourceWords }
                }));
                // CẬP NHẬT CỤC BỘ UI, KHÔNG GỌI renderApp()
                updateRearrangeUI(sentenceWords, sourceWords, isAnswered);
            };

            // Listener chung cho cả hai khu vực
            document.getElementById('question-container').addEventListener('click', (e) => {
                if (isAnswered) return;
                
                const target = e.target.closest('.word-block');
                if (!target) return;

                const action = target.dataset.action;
                const id = parseInt(target.dataset.id);
                const text = target.dataset.text;

                if (action === 'select') {
                    // Từ Source -> Sentence
                    const wordIndex = sourceWords.findIndex(w => w.id === id);
                    if (wordIndex !== -1) {
                        const word = sourceWords.splice(wordIndex, 1)[0];
                        sentenceWords.push(word);
                        saveStateAndRefreshUI();
                    }
                } else if (action === 'return') {
                    // Từ Sentence -> Source
                    const wordIndex = sentenceWords.findIndex(w => w.id === id);
                    if (wordIndex !== -1) {
                        const word = sentenceWords.splice(wordIndex, 1)[0];
                        sourceWords.push(word);
                        sourceWords.sort((a, b) => a.id - b.id); // Sắp xếp lại
                        saveStateAndRefreshUI();
                    }
                }
            });
            
            // Submission logic
            submitButton?.addEventListener('click', () => {
                if (sentenceWords.length === 0) {
                    showMessage('Vui lòng sắp xếp các từ trước khi kiểm tra!', 'info');
                    return;
                }
                
                const submitted = sentenceWords.map(w => w.text).join(' ').replace(/\s+([.,?!])/g, '$1').trim();
                
                const normalize = (str) => str.replace(/[.,?!]/g, '').replace(/\s+/g, ' ').toLowerCase().trim();
                const submittedNormalized = normalize(submitted);
                const correctNormalized = normalize(question.correctAnswer);
                
                const isCorrect = submittedNormalized === correctNormalized;

                // Xóa trạng thái tạm thời khi câu hỏi kết thúc
                sessionStorage.removeItem('rearrangeState');

                handleSubmit(submitted, isCorrect);
            });
        }

        // --- Main Render Logic ---

        function renderQuizScreen() {
            if (shuffledQuestions.length === 0) {
                // This shouldn't happen if handleStartQuiz runs correctly, but for safety
                return `<div class="text-center p-8">Đang tải câu hỏi...</div>`;
            }

            const currentQuestion = shuffledQuestions[currentQuestionIndex];
            const progressPercentage = ((currentQuestionIndex + 1) / shuffledQuestions.length) * 100;
            
            let questionHtml = '';
            let setupListeners = () => {};

            switch (currentQuestion.type) {
                case 'rearrange':
                    questionHtml = renderRearrangeQuestion(currentQuestion, currentQuestionIndex);
                    setupListeners = () => setupRearrangeListeners(currentQuestion);
                    break;
                case 'mc':
                    questionHtml = renderMultipleChoiceQuestion(currentQuestion, currentQuestionIndex);
                    setupListeners = () => setupMultipleChoiceListeners(currentQuestion);
                    break;
                case 'fill-in-the-blank':
                    questionHtml = renderFillInTheBlankQuestion(currentQuestion, currentQuestionIndex);
                    setupListeners = () => setupFillInTheBlankListeners(currentQuestion);
                    break;
                default:
                    questionHtml = `<p>Không xác định loại câu hỏi.</p>`;
            }
            
            const hintHtml = currentQuestion.hint_vi ? `
                <div class="relative inline-block" id="hint-container">
                    <button
                        id="hint-button"
                        class="bg-yellow-500 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 hover:bg-yellow-600 active:scale-95"
                    >
                        Giữ để xem Gợi ý
                    </button>
                    <div id="hint-box" class="absolute bottom-full mb-2 w-max max-w-sm p-4 bg-yellow-100 border-l-4 border-yellow-500 rounded-lg transition-opacity duration-300 opacity-0 pointer-events-none">
                        <p class="font-semibold text-yellow-800">Gợi ý (Hint):</p>
                        <p class="text-yellow-700">${currentQuestion.hint_vi}</p>
                        ${currentQuestion.hint_en ? `<p class="text-yellow-700 italic mt-1 text-sm">${currentQuestion.hint_en}</p>` : ''}
                    </div>
                </div>
            ` : '';


            return `
                <div class="fade-in">
                    <header class="text-center mb-8">
                        <h1 class="text-3xl sm:text-4xl font-extrabold text-blue-600 mb-2">Bài Thi Thử IOE Lớp 7</h1>
                        <p class="text-lg text-gray-500">Trắc nghiệm, Sắp xếp câu & Điền từ Tiếng Anh</p>
                        ${renderProgressBar(progressPercentage)}
                    </header>

                    <div class="flex justify-between items-center mb-6 py-2 px-4 bg-blue-50 rounded-lg shadow-inner">
                        <p class="text-sm sm:text-base font-medium text-blue-800">Người chơi: <span class="font-bold">${playerName}</span></p>
                        <p class="text-sm sm:text-base font-medium text-blue-800">Điểm: <span class="text-xl font-extrabold text-red-600">${score}</span></p>
                        <p class="text-sm sm:text-base font-medium text-blue-800">Tiến độ: <span class="font-bold">${currentQuestionIndex + 1}/${shuffledQuestions.length}</span></p>
                    </div>

                    <div class="mb-8" id="question-container">
                        ${questionHtml}
                    </div>

                    <div class="mt-8 border-t pt-6">
                        ${hintHtml}
                    </div>

                    ${isAnswered ? renderRationaleBox(currentQuestion, isCorrect, submittedAnswer) : ''}

                    <button 
                        id="next-button"
                        ${!isAnswered ? 'disabled' : ''}
                        class="w-full py-3 px-4 bg-blue-500 text-white font-bold rounded-lg shadow-xl transition duration-300 hover:bg-blue-600 mt-8 disabled:bg-gray-400 disabled:cursor-not-allowed"
                    >
                        ${currentQuestionIndex === shuffledQuestions.length - 1 ? 'Hoàn thành' : 'Tiếp Theo »'}
                    </button>
                </div>
            `;
        }

        function setupQuizScreenListeners() {
            const nextButton = document.getElementById('next-button');
            nextButton?.addEventListener('click', handleNext);

            // Hint logic
            const hintButton = document.getElementById('hint-button');
            const hintBox = document.getElementById('hint-box');
            if (hintButton && hintBox) {
                const showHint = () => {
                    hintBox.classList.remove('opacity-0', 'pointer-events-none');
                    hintBox.classList.add('opacity-100');
                };
                const hideHint = () => {
                    hintBox.classList.remove('opacity-100');
                    hintBox.classList.add('opacity-0', 'pointer-events-none');
                };
                
                hintButton.addEventListener('mouseenter', showHint);
                hintButton.addEventListener('mouseleave', hideHint);
                hintButton.addEventListener('touchstart', showHint);
                hintButton.addEventListener('touchend', hideHint);
            }

            // Setup question specific listeners
            const currentQuestion = shuffledQuestions[currentQuestionIndex];
            switch (currentQuestion.type) {
                case 'mc':
                    setupMultipleChoiceListeners(currentQuestion);
                    break;
                case 'fill-in-the-blank':
                    setupFillInTheBlankListeners(currentQuestion);
                    break;
                case 'rearrange':
                    setupRearrangeListeners(currentQuestion);
                    break;
            }
        }

        // --- Main App Renderer ---

        function renderApp() {
            let contentHtml = '';
            let setupListeners = () => {};

            switch (gameState) {
                case 'start':
                    contentHtml = renderStartScreen();
                    setupListeners = setupStartScreenListeners;
                    sessionStorage.removeItem('rearrangeState'); // Clear state on start
                    clearMessageBox(); // Clear any lingering messages
                    break;
                case 'quiz':
                    contentHtml = renderQuizScreen();
                    setupListeners = setupQuizScreenListeners;
                    break;
                case 'end':
                    contentHtml = renderEndScreen();
                    setupListeners = setupEndScreenListeners;
                    clearMessageBox(); // Clear any lingering messages
                    break;
            }

            appRoot.innerHTML = contentHtml;
            setupListeners();
            renderMessageBox(); // Render message box outside appRoot
        }

        // --- Initial Load ---
        window.onload = function() {
            // Khởi tạo trạng thái ban đầu nếu cần
            if (shuffledQuestions.length === 0) {
                 shuffledQuestions = shuffleArray(questions);
            }
            renderApp();
        };

    </script>
</body>
</html>
